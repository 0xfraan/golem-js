version: "3.5"
services:
  provider-1:
    build:
      context: .
      dockerfile: Provider.Dockerfile
    image: provider:latest
    restart: always
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /root/.local/share/yagna/
    devices:
      - /dev/kvm:/dev/kvm
    healthcheck:
      test: ["CMD-SHELL", "curl -s -o /dev/null -w '%{http_code}' http://localhost:7465 | grep -q 401"]
      interval: 10s
      timeout: 5s
      retries: 1
      start_period: 40s
    environment:
      - NODE_NAME=provider-1
      - SUBNET=notpublic
  provider-2:
    build: .
    image: provider:latest
    restart: always
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /root/.local/share/yagna/
    devices:
      - /dev/kvm:/dev/kvm
    healthcheck:
      test: ["CMD-SHELL", "curl -s -o /dev/null -w '%{http_code}' http://localhost:7465 | grep -q 401"]
      interval: 10s
      timeout: 5s
      retries: 1
      start_period: 40s
    environment:
      - NODE_NAME=provider-2
      - SUBNET=notpublic
  requestor:
    build:
      context: .
      dockerfile: Requestor.Dockerfile
    image: requestor:latest
    restart: always
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /root/.local/share/yagna/
    ports:
      - 7465:7465
      - 7464:7464
    environment:
      - YAGNA_AUTOCONF_APPKEY=e2e-test
      - YAGNA_API_URL=http://0.0.0.0:7465
      - GSB_URL=tcp://0.0.0.0:7464

    healthcheck:
      test: ["CMD-SHELL", "curl -s -o /dev/null -w '%{http_code}' http://localhost:7465 | grep -q 401"]
      interval: 10s
      timeout: 5s
      retries: 1
      start_period: 40s
